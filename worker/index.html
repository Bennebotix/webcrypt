<script>
  if ("serviceWorker" in navigator && !navigator.serviceWorker.controller) {
    try {
      navigator.serviceWorker.register(
        "./backend.js"
      ).then(reg => {
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({ });
        } else {
          navigator.serviceWorker.ready.then(sw => {
            sw.active.postMessage({ });
          });
        }
        console.log(
          "Service Worker registered with scope:",
          reg.scope
        );
                
      });
    } catch (error) {
      console.error("Service Worker registration failed:", error);
    }
  } else {
    if (navigator.serviceWorker.controller) {
      navigator.serviceWorker.controller.postMessage({ });
    } else {
      navigator.serviceWorker.ready.then(sw => {
        sw.active.postMessage({ });
      });
    }
  }
  
  navigator.serviceWorker.addEventListener("message", e => {
    console.log("Message from service worker:", e);
    const p = window.location.pathname;
    const loc = e.data.new ? "portal" : "data";
    if (p.endsWith("/")) {
      window.location.pathname = p + loc;
    } else if (p.includes(".", p.lastIndexOf("/"))) {
      window.location.pathname = p.slice(0, p.lastIndexOf("/") + 1) + loc;
    } else {
      window.location.pathname = p + "/" + loc;
    }
  });
</script>
